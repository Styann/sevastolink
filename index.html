<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEVASTOLINK</title>

    <link rel="stylesheet" href="style/app.css">
    <link rel="stylesheet" href="style/mosaic.css">
    <link rel="stylesheet" href="style/menu.css">

    <link rel="stylesheet" href="style/ArchiveLog.css">
    <link rel="stylesheet" href="style/Folder.css">

    <script type="text/javascript" src="script/app.js"></script>
    <script type="text/javascript" src="script/async.js"></script>
</head>
<body>

    <div id="mosaic" class="mosaic"> 
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
    </div>

    <div id="sign-in" class="sign-in-background">
            <div class="sign-in">
                <label class="sign-in-label retro-black">SIGN&nbsp;&nbsp;&nbsp;IN</label>
            </div>
    </div>

    <div id="loading-page" class="loading-page">

        <div class="logo">
            <p class="retro-green" style="font-size: 150px; margin: 0;">SEVASTOLINK</p>
    
            <p class="retro-green company-name fz30">AN LM-LINK PRODUCT</p>
        </div>
       
    
        <div class="progress-bar-wrapper">
            <div class="progress-bar">
                <div id="progress" class="progress"></div>
            </div>
  
            <p class="copyright retro-green fz30">(C) LM-LINK DATA SYSTEMS</p>    
        </div>
    
    </div>

    <div id="menu" class="menu">
        <div class="title-bar retro-white">
            <label class="retro-black fz30">PERSONAL TERMINAL</label>
            <div class="close-button"></div>
        </div>

        <div class="parent">

            <div class="folders">
                <div class="folders-label">
                    <label class="retro-green fz30">FOLDERS</label>
                </div>
         
                <div class="plb"></div>
                <div id="personal" class="folder personal">
                    <label class="retro">PERSONAL</label>
                </div>
                <div class="prb right-border-preselected"></div>

                <div class="slb"></div>
                <div id="shared" class="folder shared">
                    <label class="retro">SHARED</label>
                </div>
                <div class="srb"></div>
          
                <div class="alb"></div>
                <div id="audio" class="folder audio">
                    <label class="retro">AUDIO</label>
                </div>            
                <div class="arb"></div>

                <div class="ulb"></div>
                <div id="utility" class="folder utility">
                    <label class="retro">UTILITY</label>
                </div>
                <div class="urb"></div>       
            </div>

            <div class="div2">
                <div id="file-pointer" class="angle step4"></div> 
            </div>
            
            <div class="div3">
                <div id="archive-log-list" class="archive-log-list"></div>

                <div tabindex="0" id="archive-log-content" class="archive-log-content retro-white fz30 disabled-focus">
                    <p></p>
                </div>
            </div> 
    </div>

    <div>
   
    </div>

    <script type="module">
        import {Root} from './script/Root.js';
        import {Folder} from './script/Folder.js';
        import {ArchiveLog} from './script/ArchiveLog.js';


        const signin = document.getElementById('sign-in');
        
        const mosaic = document.getElementById('mosaic');
        const children = mosaic.children;

        const loadingPage = document.getElementById('loading-page');
        const progressbar = document.getElementById('progress');

        const menu = document.getElementById('menu');


        const controls = {
            "forward" : 90,
            "backward" : 83,
            "left" : 81,
            "right" : 68,
            "use": 69,
            "return" : 65,
            "page-up" : 33,
            "page-down" : 34
        };

        const files = document.getElementsByClassName('file');
        const file1 = document.getElementById('file1');
        const file2 = document.getElementById('file2');
        const fileContent = document.getElementById('archive-log-content');
        const archiveLogList = document.getElementById('archive-log-list');     

        const personalFolder = new Folder(document.getElementById('personal'), [], archiveLogList, [get(0,'plb'), get(0, 'prb')]);
        const sharedFolder = new Folder(document.getElementById('shared'), [], archiveLogList, [get(0,'slb'), get(0, 'srb')]);
        const audioFolder = new Folder(document.getElementById('audio'), [], archiveLogList, [get(0,'alb'), get(0, 'arb')]);
        const utilityFolder = new Folder(document.getElementById('utility'), [], archiveLogList, [get(0,'ulb'), get(0, 'urb')]);

        let archiveLogJSON = null;
        const archiveLogsJSON = JSON.parse(loadFile('./script/archiveLogs.json'));
        for(let i = 0; i<6; i++){
            archiveLogJSON = archiveLogsJSON['files'][i];
            personalFolder.addArchiveLog(new ArchiveLog(archiveLogJSON['id'], archiveLogJSON['title'], archiveLogJSON['content'], null, fileContent));
        }

        for(let i = 2; i<4; i++){
            archiveLogJSON = archiveLogsJSON['files'][i];
            var file = (i==2) ? file1 : file2;
            sharedFolder.addArchiveLog(new ArchiveLog(archiveLogJSON['id'], archiveLogJSON['title'], archiveLogJSON['content'], file, fileContent));
        }

        for(let i = 6; i<8; i++){
            archiveLogJSON = archiveLogsJSON['files'][i];
            var file = (i==6) ? file1 : file2;
            utilityFolder.addArchiveLog(new ArchiveLog(archiveLogJSON['id'], archiveLogJSON['title'], archiveLogJSON['content'], file, fileContent));
        }


        for(let i = 0; i<151; i++){
            archiveLogJSON = archiveLogsJSON['files'][i];
            if(archiveLogJSON["audio"] !== ""){
                audioFolder.addArchiveLog(new ArchiveLog(archiveLogJSON['id'], archiveLogJSON['title'], archiveLogJSON['content'], file1, fileContent, archiveLogJSON["audio"]));
            }
        }


    
        const root = new Root([personalFolder, sharedFolder, audioFolder, utilityFolder], get('file-pointer'));

        async function runMosaicTransition(){
            display(mosaic, 'grid');
            for(let i=0; i<170; i++){
                children[i].firstChild.style.animationPlayState = 'running';
            }
            await delay(200);
            display(mosaic, 'none');
        }

        document.addEventListener('keydown', async (pressedKey) => {

            if(pressedKey.repeat){

            }else{
                try{
                    switch(pressedKey.keyCode){
                        case controls["forward"]:
                            if(!root.currentFolder.isSelected){
                                //move folder above
                                root.preselectAboveFolder();
                                root.currentFolder.setupFiles();
                            }else{
                                //move file above
                                root.currentFolder.selectAboveFile();
                            }
    
                            break;
        
                        case controls["backward"]:
                            if(!root.currentFolder.isSelected){
                                //move folder below
                                root.preselectBelowFolder();
                                root.currentFolder.setupFiles();
                            }else{
                                //move file below
                                root.currentFolder.selectBelowFile();
                            }
                            break;
                        
                        case controls["use"]:
                            if(!root.currentFolder.isSelected){
                                //select folder and file 1
                                root.currentFolder.unpreselect();
                                root.currentFolder.select();
                                root.currentFolder.currentFile.select();
                            }else{
                                //trying to select a file with no success
                                if(root.currentFolder.currentFile.audio){
                                    root.currentFolder.currentFile.audio.play();
                                }else{
                                    root.currentFolder.currentFile.bip();
                                }
                            }
                            break;
                        case controls["return"]:
                            if(root.currentFolder.isSelected){
                                //unselect folder
                                root.currentFolder.unselect(false);
                                root.currentFolder.currentFile.unselect();
                            }else{
                                //return to sign in
                                display(menu, 'none');
                                await runMosaicTransition();
                                location.reload();
                            }
                            break;
                    }
                }catch(error){
                }
            }
        });

 

        /*preselect folder -> TELEM 4
            select folder -> telem 1.2
            'mail' ineffective click -> telem 7 & 6 & 3 & 5
            change log -> 6*/
        const startup = new Audio('SFX/Interactive_Terminal_Startup.ogg');
        startup.volume = 0.3;
        
        const loop = new Audio('SFX/Interactive_Terminal_BG_Loop.ogg');
        loop.volume = 0;
        loop.loop = true;


        (async () => {
            
            //1
            /*await waitForKey(undefined, true);
            display(signin, 'none');
            loop.play();

            //1

            await runMosaicTransition();
            
            //2
            display(loadingPage, 'grid');
     
            animationState(progressbar, true);
            startup.play();
            
            await delay(5500);
            loop.volume = 0.045;
            display(loadingPage, 'none');
            //2
        
            await runMosaicTransition();*/
            
            //3
            display(menu, 'grid');
            //3
        })();

    </script>


    
</body>

</html>