<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEVASTOLINK</title>

    <link rel="stylesheet" href="style/app.css">
    <link rel="stylesheet" href="style/mosaic.css">
    <link rel="stylesheet" href="style/menu.css">

</head>
<body>

    <div id="mosaic" class="mosaic"> 
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
    </div>
    



    <div id="sign-in" class="sign-in-background">
            <div class="sign-in">
                <label class="retro-black">SIGN&nbsp;&nbsp;&nbsp;IN</label>
            </div>
    </div>

    <div id="loading-page" class="loading-page">

        <div class="logo">
            <p class="retro-green" style="font-size: 150px; margin: 0;">SEVASTOLINK</p>
    
            <p class="retro-green company-name fz30">AN LM-LINK PRODUCT</p>
        </div>
       
    
        <div class="progress-bar-wrapper">
            <div class="progress-bar">
                <div id="progress" class="progress"></div>
            </div>
  
            <p class="copyright retro-green fz30">(C) LM-LINK DATA SYSTEMS</p>    
        </div>
    
    </div>

    <div id="menu" class="menu">
        <div class="title-bar retro-white">
            <label class="retro-black fz30">PERSONAL TERMINAL</label>
            <div class="close-button"></div>
        </div>

        <div class="parent">

            
            <div class="folders">
                <div class="string-1"></div>
                

                <div class="folders-label">
                    <label class="retro-green fz30">FOLDERS</label>
                </div>
                <div id="personal" class="folder personal">
                    <label class="retro">PERSONAL</label>
                </div>
                <div id="shared" class="folder shared">
                    <label class="retro">SHARED</label>
                </div>
                <div id="audio" class="folder audio">
                    <label class="retro">AUDIO</label>
                </div>
                <div id="utility" class="folder utility">
                    <label class="retro">UTILITY</label>
                </div>
            </div>

            
            <div class="div2">
                <div id="file1" class="file file1">
                        <label class="retro-white"></label>
                        <div class="play-icon"></div>
                </div>
                <div id="file2" class="file file2">
                    <label class="retro-white"></label>
                </div>
                <div tabindex="0" id="file-content" class="file-content retro-white fz30 disabled-focus">
                    <p></p>
                </div>
            </div> 
    </div>

    <div>
   
    </div>



    
</body>
    <script type="text/javascript" src="script/app.js"></script>
    <script type="text/javascript" src="script/async.js"></script>
    <script type="module">
        import {Root} from './script/Root.js';
        import {Folder} from './script/Folder.js';
        import {File} from './script/File.js';


        const signin = document.getElementById('sign-in');
        
        const mosaic = document.getElementById('mosaic');
        const children = mosaic.children;

        const loadingPage = document.getElementById('loading-page');
        const progressbar = document.getElementById('progress');

        const menu = document.getElementById('menu');


        var preselectedFolder = null;
        var selectedFolder = personal;

        const controls = {
            "forward" : 90,
            "backward" : 83,
            "left" : 81,
            "right" : 68,
            "use": 69,
            "return" : 65,
            "page-up" : 33,
            "page-down" : 34
        };

        const files = document.getElementsByClassName('file');
        const file1 = document.getElementById('file1');
        const file2 = document.getElementById('file2');
        const fileContent = document.getElementById('file-content');

        const personalFolder = new Folder(document.getElementById('personal'), []);
        const sharedFolder = new Folder(document.getElementById('shared'), []);
        const audioFolder = new Folder(document.getElementById('audio'), []);
        const utilityFolder = new Folder(document.getElementById('utility'), []);

        let archiveLogJSON = null;
        const archiveLogsJSON = JSON.parse(loadFile('./script/archiveLogs.json'));
        for(let i = 0; i<2; i++){
            archiveLogJSON = archiveLogsJSON['files'][i];
            var file = (i==0) ? file1 : file2;
            personalFolder.addFile(new File(archiveLogJSON['id'], archiveLogJSON['title'], archiveLogJSON['content'], file, fileContent));
        }

        for(let i = 2; i<4; i++){
            archiveLogJSON = archiveLogsJSON['files'][i];
            var file = (i==2) ? file1 : file2;
            sharedFolder.addFile(new File(archiveLogJSON['id'], archiveLogJSON['title'], archiveLogJSON['content'], file, fileContent));
        }

        for(let i = 4; i<6; i++){
            archiveLogJSON = archiveLogsJSON['files'][i];
            var file = (i==4) ? file1 : file2;
            audioFolder.addFile(new File(archiveLogJSON['id'], archiveLogJSON['title'], archiveLogJSON['content'], file, fileContent));
        }

        for(let i = 6; i<8; i++){
            archiveLogJSON = archiveLogsJSON['files'][i];
            var file = (i==6) ? file1 : file2;
            utilityFolder.addFile(new File(archiveLogJSON['id'], archiveLogJSON['title'], archiveLogJSON['content'], file, fileContent));
        }


    
        const root = new Root([personalFolder, sharedFolder, audioFolder, utilityFolder]);



        /*window.addEventListener("gamepadconnected", function(e) {
            console.log("Manette connectée à l'indice %d : %s. %d boutons, %d axes.",
                e.gamepad.index, e.gamepad.id,
                e.gamepad.buttons.length, e.gamepad.axes.length);
                console.log(e.gamepad.buttons[0])
                setInterval(function(){
                    a 0
                    b 1
                    x 2
                    y 3
                    for(let i = 0; i<e.gamepad.buttons.length; i++){
                        if(e.gamepad.buttons[i].pressed){
                            console.log(i)
                        }
                    }
                }, 100)
        });*/




        document.addEventListener('keydown', (pressedKey) => {

            if(pressedKey.repeat){

            }else{
                try{
                    switch(pressedKey.keyCode){
                        case controls["forward"]:
                            if(!root.currentFolder.isSelected){
                                //move folder above
                                root.preselectAboveFolder();
                                root.currentFolder.setupFiles();
                            }else{
                                //move file above
                                root.currentFolder.selectAboveFile();
                            }
    
                            break;
        
                        case controls["backward"]:
                            if(!root.currentFolder.isSelected){
                                //move folder below
                                root.preselectBelowFolder();
                                root.currentFolder.setupFiles();
                            }else{
                                //move file below
                                root.currentFolder.selectBelowFile();
                            }
                            break;
                        
                        case controls["use"]:
                            if(!root.currentFolder.isSelected){
                                //select folder and file 1
                                root.currentFolder.unpreselect();
                                root.currentFolder.select();
                                root.currentFolder.currentFile.select();
                            }else{
                                //trying to select a file with no success
                                root.currentFolder.currentFile.bip();
                            }
                            break;
                        case controls["return"]:
                            if(root.currentFolder.isSelected){
                                //unselect folder
                                root.currentFolder.unselect(false);
                                root.currentFolder.currentFile.unselect();
                            }else{
                                //return to sign in
                                location.reload();
                            }
                            break;
                    }
                }catch(error){
                }
            }
        });


        /*mouse selection*/
        /*for(const folder of folders){
            folder.onclick = () => {
                selectFolder(folder, folders, currentFolder);
            };
        }*/

        /*mouse preselection*/
        /*for(const folder of folders){
            folder.onmouseover = () => {
                if(!folder.classList.contains('folder-selected')){
                    for(const folder of folders){
                        folder.classList.remove('folder-preselected')
                    }
                    preselectedFolder = folder;
                    preselectedFolder.classList.toggle('folder-preselected');
                }
            };

            folder.onmouseout = () => {
                if(folder.classList.contains('folder-preselected')){
                    preselectedFolder.classList.remove('folder-preselected');
                    preselectedFolder = null;
                }
            };
        }*/

        async function runMosaicTransition(){
            display(mosaic, 'grid');
            for(let i=0; i<170; i++){
                children[i].firstChild.style.animationPlayState = 'running';
            }
            await delay(200);
            display(mosaic, 'none');
        }

        /*preselect folder -> TELEM 4
            select folder -> telem 1.2
            'mail' ineffective click -> telem 7 & 6 & 3 & 5
            change log -> 6*/
        const startup = new Audio('SFX/Interactive_Terminal_Startup.ogg');
        startup.volume = 0.3;
        
        const loop = new Audio('SFX/Interactive_Terminal_BG_Loop.ogg');
        loop.volume = 0;
        loop.loop = true;

        (async () => {
            
            //1
            /*await waitForKey(undefined, true);
            display(signin, 'none');
            loop.play();

            //1

            await runMosaicTransition();
            
            //2
            display(loadingPage, 'grid');
     
            animationState(progressbar, true);
            startup.play();
            
            await delay(5500);
            loop.volume = 0.045;
            display(loadingPage, 'none');
            //2
        
            await runMosaicTransition();*/
            
            //3
            display(menu, 'grid');
            //3
            
        })();
    </script>
</html>