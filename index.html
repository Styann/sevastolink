<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEVASTOLINK</title>

    <link rel="stylesheet" href="style/app.css">
    <link rel="stylesheet" href="style/mosaic.css">
    <link rel="stylesheet" href="style/menu.css">

    <link rel="stylesheet" href="style/ArchiveLog.css">
    <link rel="stylesheet" href="style/Folder.css">

    <script type="text/javascript" src="script/app.js"></script>
    <script type="text/javascript" src="script/async.js"></script>
</head>
<body>

    <div id="mosaic" class="mosaic"></div>
    <script>
        var mosaic =  document.getElementById('mosaic');
        var test = '<div class="tile-wrapper"><div class="tile"></div></div>'
        for(let i = 0; i<170; i++){
            mosaic.innerHTML += test;    
        }
    </script>

    <div id="sign-in" class="sign-in-background">
            <div class="sign-in">
                <label class="sign-in-label retro-black">SIGN&nbsp;&nbsp;&nbsp;IN</label>
            </div>
    </div>

    <div id="loading-page" class="loading-page">

        <div class="logo">
            <p class="retro-green" style="font-size: 150px; margin: 0;">SEVASTOLINK</p>
    
            <p class="retro-green company-name fz30">AN LM-LINK PRODUCT</p>
        </div>
       
    
        <div class="progress-bar-wrapper">
            <div class="progress-bar">
                <div id="progress" class="progress"></div>
            </div>
  
            <p class="copyright retro-green fz30">(C) LM-LINK DATA SYSTEMS</p>    
        </div>
    
    </div>

    <div id="menu" class="menu">
        <div class="title-bar retro-white">
            <label class="retro-black fz30">PERSONAL TERMINAL</label>
            <div class="close-button"></div>
        </div>

        <div class="parent">

            <div class="folders">
                <div class="folders-label">
                    <label class="retro-green fz30">FOLDERS</label>
                </div>
         
                <div class="plb"></div>
                <div id="personal" class="folder personal">
                    <label class="retro">PERSONAL</label>
                </div>
                <div class="prb right-border-preselected"></div>

                <div class="slb"></div>
                <div id="shared" class="folder shared">
                    <label class="retro">SHARED</label>
                </div>
                <div class="srb"></div>
          
                <div class="alb"></div>
                <div id="audio" class="folder audio">
                    <label class="retro">AUDIO</label>
                </div>            
                <div class="arb"></div>

                <div class="ulb"></div>
                <div id="utility" class="folder utility">
                    <label class="retro">UTILITY</label>
                </div>
                <div class="urb"></div>       
            </div>

            <div class="div2">
                <div id="file-pointer" class="angle step4"></div> 
            </div>
            
            <div class="div3">
                <div id="archive-log-list" class="archive-log-list"></div>

                <div tabindex="0" id="archive-log-content" class="archive-log-content retro-white fz30 disabled-focus">
                    <p></p>
                </div>
            </div> 
    </div>

    <script type="module">
        import {Root} from './script/Root.js';
        import {Folder} from './script/Folder.js';
        import {ArchiveLog} from './script/ArchiveLog.js';

        const signin = document.getElementById('sign-in');
        
        const mosaic = document.getElementById('mosaic');
        const children = mosaic.children;

        const loadingPage = document.getElementById('loading-page');
        const progressbar = document.getElementById('progress');

        const menu = document.getElementById('menu');


        const fileContent = document.getElementById('archive-log-content');
        const archiveLogList = document.getElementById('archive-log-list');     

        Folder.archiveLogsJSON = await loadJSON('./script/archiveLogs.json');
        const personalFolder = new Folder('personal', document.getElementById('personal'), [get(0,'plb'), get(0, 'prb')]);
        const sharedFolder = new Folder('shared', document.getElementById('shared'), [get(0,'slb'), get(0, 'srb')]);
        const audioFolder = new Folder('audio', document.getElementById('audio'), [get(0,'alb'), get(0, 'arb')]);
        const utilityFolder = new Folder('utility', document.getElementById('utility'), [get(0,'ulb'), get(0, 'urb')]);

        const root = new Root([personalFolder, sharedFolder, audioFolder, utilityFolder], get('file-pointer'));

        async function runMosaicTransition(){
            display(mosaic, 'grid');
            for(let i=0; i<170; i++){
                children[i].firstChild.style.animationPlayState = 'running';
            }
            await delay(200);
            display(mosaic, 'none');
        }

        const startup = new Audio('SFX/Interactive_Terminal_Startup.ogg');
        startup.volume = 0.3;
        
        const loop = new Audio('SFX/Interactive_Terminal_BG_Loop.ogg');
        loop.volume = 0;
        loop.loop = true;

        //(async () => {
            
            //1
        await waitForKey('e', true);
        display(signin, 'none');
        loop.play();

        //1

        await runMosaicTransition();
        
        //2
        display(loadingPage, 'grid');
    
        animationState(progressbar, true);
        startup.play();
        
        await delay(5500);
        loop.volume = 0.045;
        display(loadingPage, 'none');
        //2
    
        await runMosaicTransition();
        
        //3
        display(menu, 'grid');
        root.running = true;
            //3
        //})();

    </script>


    
</body>

</html>