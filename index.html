<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEVASTOLINK</title>

    <link rel="stylesheet" href="style/app.css">
    <link rel="stylesheet" href="style/mosaic.css">
    <link rel="stylesheet" href="style/menu.css">

</head>
<body>

    <div id="mosaic" class="mosaic"> 
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
        <div class="tile-wrapper"><div class="tile"></div></div>
    </div>
    



    <div id="sign-in" class="sign-in-background">
            <div class="sign-in">
                <label class="retro-black">SIGN&nbsp;&nbsp;&nbsp;IN</label>
            </div>
    </div>

    <div id="loading-page" class="loading-page">

        <div class="logo">
            <p class="retro-green" style="font-size: 150px; margin: 0;">SEVASTOLINK</p>
    
            <p class="retro-green company-name fz30">AN LM-LINK PRODUCT</p>
        </div>
       
    
        <div class="progress-bar-wrapper">
            <div class="progress-bar">
                <div id="progress" class="progress"></div>
            </div>
  
            <p class="copyright retro-green fz30">(C) LM-LINK DATA SYSTEMS</p>    
        </div>
    
    </div>

    <div id="menu" class="menu">
        <div class="title-bar retro-white">
            <label class="retro-black fz30">PERSONAL TERMINAL</label>
            <div class="close-button"></div>
        </div>

        <div class="parent">
            <div class="folders">
                <div class="folders-label">
                    <label class="retro-green fz30">FOLDERS</label>
                </div>
                <div id="personal" class="folder personal folder-preselected">
                    <label class="retro">PERSONAL</label>
                </div>
                <div id="shared" class="folder shared">
                    <label class="retro">SHARED</label>
                </div>
                <div id="audio" class="folder audio">
                    <label class="retro">AUDIO</label>
                </div>
                <div id="utility" class="folder utility">
                    <label class="retro">UTILITY</label>
                </div>
            </div>

            
            <div class="div2">
                <div class="file file1">
                    <label class="retro-white file-label">AUTOPSY</label>
                </div>
                <div class="file file2">
                    <label class="retro-white file-label">File 1</label>
                </div>
                <div id="file-content" class="file-content retro-white fz30">
                </div>
            </div> 
    </div>



    
</body>
    <script type="text/javascript" src="script/app.js"></script>
    <script type="text/javascript" src="script/async.js"></script>
    <script type="module">
        import {SystemTree} from './script/SystemTree.js';
        import {Folder} from './script/Folder.js';
        import {File} from './script/File.js';


        const t = "Hughes, I've put a manual lock on the door leading upstairs. Don't want any accidents until we figure what's going on here. \n\nChief <span class='retro-code'>0123</span>";
        const fileContent = document.getElementById('file-content');
        fileContent.innerHTML = t;

        const signin = document.getElementById('sign-in');
        
        const mosaic = document.getElementById('mosaic');
        const children = mosaic.children;

        const loadingPage = document.getElementById('loading-page');
        const progressbar = document.getElementById('progress');

        const menu = document.getElementById('menu');


        var preselectedFolder = null;
        var selectedFolder = personal;

        const controls = {
            "forward" : 90,
            "backward" : 83,
            "left" : 81,
            "right" : 68,
            "use": 69,
            "return" : 65
        };
        
        var ogg = 'SFX/Interactive_Terminal_Telem_0' ;
        const unableAudio = [new Audio(ogg+'3.ogg'), new Audio(ogg+'6.ogg'), new Audio(ogg+'7.ogg')];
        for(let i=0; i<3; i++) unableAudio.volume = 0.2;

        const fileSelectionAudio = new Audio('SFX/Interactive_Terminal_Telem_04.ogg')
        fileSelectionAudio.volume = 0.3;

        const fileTest = new File(1, 'TEST', 'TEST.', document.getElementById('file1'));
        
        const systemTree = new SystemTree([
            new Folder(document.getElementById('personal'), [fileTest]),
            new Folder(document.getElementById('shared'), []),
            new Folder(document.getElementById('audio'), []),
            new Folder(document.getElementById('utility'), [])
        ]);

 
        const files = document.getElementsByClassName('file');



        document.addEventListener('keydown', async (pressedKey) => {
            try{
                switch(pressedKey.keyCode){
                    case controls["forward"]:
                        systemTree.preselectAboveFolder();
                        break;
    
                    case controls["backward"]:
                        systemTree.preselectBelowFolder();
                        break;
                    
                    case controls["use"]:
                        if(!systemTree.currentFolder.isSelected){
                            systemTree.currentFolder.unpreselect();
                            systemTree.currentFolder.select();
                            fileSelectionAudio.play();

                            //systemTree.currentFolder.currentFile.select();
                            console.log(systemTree.currentFolder.currentFile)
                        }
                        break;
                    case controls["return"]:
                        if(systemTree.currentFolder.isSelected){
                            systemTree.currentFolder.unselect();
                            systemTree.currentFolder.preselect();
                        }else{
                            console.log('ololo')
                            location.reload();
                            /*display(loadingPage, 'none');
                            display(menu, 'none');
                            display(signin, 'grid');*/
                        }
                        break;
                }
            }catch(error){
                unableAudio[getRandomInt(3)].play();
            }
        });


        /*mouse selection*/
        /*for(const folder of folders){
            folder.onclick = () => {
                selectFolder(folder, folders, currentFolder);
            };
        }*/

        /*mouse preselection*/
        /*for(const folder of folders){
            folder.onmouseover = () => {
                if(!folder.classList.contains('folder-selected')){
                    for(const folder of folders){
                        folder.classList.remove('folder-preselected')
                    }
                    preselectedFolder = folder;
                    preselectedFolder.classList.toggle('folder-preselected');
                }
            };

            folder.onmouseout = () => {
                if(folder.classList.contains('folder-preselected')){
                    preselectedFolder.classList.remove('folder-preselected');
                    preselectedFolder = null;
                }
            };
        }*/

        async function runMosaicTransition(){
            display(mosaic, 'grid');
            for(let i=0; i<170; i++){
                children[i].firstChild.style.animationPlayState = 'running';
            }
            await delay(200);
            display(mosaic, 'none');
        }

        /*select files -> TELEM 4
            select 'mail' -> telem 2
            'mail' ineffective click -> telem 7 & 6 & 3 & 5*/
        const startup = new Audio('SFX/Interactive_Terminal_Startup.ogg');
        startup.volume = 0.3;
        
        const loop = new Audio('SFX/Interactive_Terminal_BG_Loop.ogg');
        loop.volume = 0;
        loop.loop = true;

        (async () => {
            
            //1
            await waitForKey(undefined, true);
            display(signin, 'none');
            loop.play();

            //1

            await runMosaicTransition();
            
            //2
            display(loadingPage, 'grid');
     
            animationState(progressbar, true);
            startup.play();
            
            await delay(5500);
            loop.volume = 0.045;
            display(loadingPage, 'none');
            //2
        
            await runMosaicTransition();
            
            //3
            display(menu, 'grid');
            //3
            
        })();
    </script>
</html>